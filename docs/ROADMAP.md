# AIR4 — Roadmap

## Фаза 0. Подготовка среды (1 неделя)
Цель: воспроизводимая локальная среда под macOS (M-серия).  
Что делаем:
- Создать монорепозиторий: air4/  
    - backend/ (FastAPI), memory/ (Chroma), ui/ (React+Tauri), scripts/, docs/
- Настроить pyenv/poetry или venv, Node LTS, Rust (для Tauri), Git hooks.
- Завести .env.template (порты, пути памяти, SAFE_WORD, PANIC_PHRASE).
- Установить Ollama, скачать базовую модель (Mistral 7B / Llama 3 8B q4_0).  

Артефакты:
- README.md с командами запуска.
- .env.template и Makefile/npm scripts.

Definition of Done (DoD):
- Команда make dev поднимает Ollama и FastAPI «hello world».
- В репозитории настроен линт/формат (ruff, black, eslint, prettier).

---

## Фаза 1. Ядро LLM + API (2 недели)
Цель: чат-эндпоинт с системным промптом и настройками.  
Что делаем:
- FastAPI: POST /chat (вход: messages[], выход: assistant_message).
- Адаптер к Ollama (stream/без stream).
- Системный промпт: стиль, рус/eng, «не льстить, по делу».
- Логи (локально), таймауты и ограничение размера контекста.  

Артефакты:
- backend/app/main.py, backend/app/llm_ollama.py
- Тесты pytest для /chat.

DoD:
- Локальный запрос → ответ ≤ 2–3 с на M4 Max (7–8B q4_0).
- Юнит-тесты проходят, код покрыт ≥60%.

Риски:
- Длинный контекст → обрезка/суммаризация до окна 4–8К токенов.

---

## Фаза 2. Память + RAG (2 недели)
Цель: долговременная память и поиск «по смыслу».  
Что делаем:
- ChromaDB: коллекции facts, notes, conversations.
- Эмбеддинги (llama.cpp/Instructor) локально через Ollama или встроенные.
- Эндпоинты:
    - POST /memory/add (текст, метаданные)
    - GET /memory/search?q=... (семантический поиск, топ-k)
- RAG-цепочка (LangChain): поиск релевантного контента + ответ модели.  

Артефакты:
- backend/app/memory.py, backend/app/rag.py
- Схема индексации (метаданные: дата, тип, источник, теги)

DoD:
- На запрос «Что я говорил про отпуск в мае?» возвращаются сохранённые факты.
- Время ответа RAG ≤ 1.5–2.5 с (на локальном индексе до 20–50К записей).

Риски:
- Рост базы → деградация поиска. Меры: переиндексация/сжатие.

---

## Фаза 3. Безопасность (1 неделя)
Цель: реальные «ворота» безопасности.  
Что делаем:
- Логин-экран: пароль (PBKDF2/Argon2), мастер-ключ для шифрования.

